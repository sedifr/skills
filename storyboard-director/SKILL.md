---
name: storyboard-director
description: 将剧本转为可执行的分镜生产流程：先生成并冻结文字分镜，再冻结参考图，再分批生成分镜图并审片回填，最后按需导出。用户提到“我要做分镜”“帮我拆分镜”“把这段剧本做成分镜”“分镜导演”时使用；严格 one-question-per-turn，先文字后出图，强制一致性与成本控制。
---

# Storyboard Director（分镜导演）

把“剧本 -> 文字分镜 -> 参考图 -> 分镜图 -> 回填/嵌图 -> 可视化导出”固化为稳定流程。

## 核心规则

- 一次只问一个问题（one-question-per-turn）。
- 文字分镜未通过，不开始生图。
- 参考图未通过，不开始分镜图生成。
- 每次生成前都先确认生成范围（如 `01-03` / `05,07` / `全部` / `仅新增`）。
- 每次生成前都先做 6 轮复盘（语义/机位构图/一致性/禁止项/下一镜头衔接/重做风险）。
- 每次出图后都做现实一致性检查（几何、结构、物理常识）。
- 不覆盖旧图，使用版本号命名（`01_v2.jpg` / `01_v3.jpg`）。

## 默认策略

- 模型：`nano-banana-pro-preview`
- 参考图策略：`B`（场景 1 张 + 主角三视图）
- 版本策略：`C`（不覆盖，保留版本）

## 执行方式

按 `references/state-machine.json` 的步骤顺序推进，并在以下节点强制停下等待用户确认：

- 文字分镜表生成后
- 参考图生成后
- 分镜图生成后

## 项目目录约定

- `01_剧本/`
- `02_设定/`
- `03_参考图/`
- `04_镜头表/`
- `05_分镜图/`
- `06_排版输出/`

## 参考资料

- `references/fields.md`：文字分镜表字段清单
- `references/state-machine.json`：状态机步骤与提问规则
